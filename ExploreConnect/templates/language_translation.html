{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Translation</title>
    <link rel="stylesheet" href="{% static 'css/style3.css' %}">
</head>
<body>
    <div class="navbar">
        <div class="logo">ExploreConnect</div>
        <ul class="nav-links">
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'destination' %}">Destinations</a></li>
            <li><a href="{% url 'profile' %}">User Profile</a></li>
            <li><a href="{% url 'logout' %}">Logout</a></li>
        </ul>
        <div class="search-bar">
            <input type="text" placeholder="Search places...">
            <button>Search</button>
        </div>
    </div>


    <div class="content">
        <h1>Language Translation</h1>
        <div class="language-selection">
            <div class="dropdowns">
                <div class="dropdown">
                    <label for="input-language">Input Language:</label>
                    <select id="input-language" name="input_language">
                        <!-- Language options will be loaded dynamically -->
                    </select>
                </div>
                <button id="swap_languages">â‡† </button>
                <div class="dropdown">
                    <label for="output-language">Output Language:</label>
                    <select id="output-language" name="output_language">
                        <!-- Language options will be loaded dynamically -->
                    </select>
                </div>

                </div>
            </div>

            <button id="start_speaking" type="button">ðŸŽ¤ Start Speaking</button>
            <button id="stop_speaking" type="button">ðŸ›‘ Stop Speaking</button>
            <button id="translate_button" type="button">ðŸ”„ Translate</button>
            <p id="status">Status: Not Speaking</p>
            <audio id="translated_audio" controls style="display: none;"></audio>
            <p id="translation_result"></p>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const startSpeakingButton = document.getElementById('start_speaking');
                const stopSpeakingButton = document.getElementById('stop_speaking');
                const translateButton = document.getElementById('translate_button');
                const statusParagraph = document.getElementById('status');
                const translatedAudio = document.getElementById('translated_audio');
                const translationResult = document.getElementById('translation_result');
                
                let recognition;
                let isSpeaking = false;
            
                if ('webkitSpeechRecognition' in window) {
                    recognition = new webkitSpeechRecognition();
                    recognition.continuous = true;
                    recognition.interimResults = true;
            
                    recognition.onresult = function (event) {
                        const transcript = Array.from(event.results)
                                                .map(result => result[0].transcript)
                                                .join('');
                        translationResult.textContent = `You said: ${transcript}`;
                    };
            
                    recognition.onend = function () {
                        isSpeaking = false;
                        statusParagraph.textContent = 'Status: Not Speaking';
                    };
                } else {
                    console.error('Speech recognition not supported');
                }
            
                startSpeakingButton.addEventListener('click', function () {
                    if (recognition && !isSpeaking) {
                        recognition.start();
                        isSpeaking = true;
                        statusParagraph.textContent = 'Status: Speaking';
                    }
                });
            
                stopSpeakingButton.addEventListener('click', function () {
                    if (recognition && isSpeaking) {
                        recognition.stop();
                    }
                });
            
                translateButton.addEventListener('click', function () {
                    const textToTranslate = translationResult.textContent.replace('You said: ', '');
                    const inputLanguage = 'en'; // Set your input language
                    const outputLanguage = 'es'; // Set your desired output language
            
                    const formData = new FormData();
                    formData.append('input_text', textToTranslate);
                    formData.append('input_language', inputLanguage);
                    formData.append('output_language', outputLanguage);
            
                    fetch('/translate-audio/', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}' // Ensure this is set correctly
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            translationResult.textContent = `Error: ${data.error}`;
                        } else {
                            translationResult.textContent = `Translation: ${data.translated_text}`;
                            translatedAudio.src = data.audio_path;
                            translatedAudio.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        translationResult.textContent = `Error: ${error}`;
                    });
                });
            });
            </script>
            
    </div>

    <footer>
        &copy; 2024 ExploreConnect. All rights reserved.
    </footer>

    <script src="{% static 'js/translation.js' %}"></script>
</body>
</html>
